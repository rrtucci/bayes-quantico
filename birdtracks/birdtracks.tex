\chapter{Birdtracks}
\label{ch-birdtracks}

This chapter is based on Cvitanovic Birdtracks book Ref. \cite{birdtracks-book}
and my paper Ref. \cite{tucci-qbnets}


The tensor notation 
discussed in Sec.\ref{sec-tensors}
 is succinct and straightforward,
but it's not
visually
illuminating. The birdtrack notation
that we shall discuss in this chapter, is not as succinct
as the tensor notation, and can lead to sign 
errors if you are careless,
but it is very visually illuminating. Thus, the tensor
and birdtrack notations complement each other well.
We will often display results
using both, side by side.

\section{Classical Bayesian Networks and their Instantiations}

Classical Bayesian Networks (bnets)
are discussed exhaustively
in the first book of this 
series, Ref.\cite{bayesuvius}.
This is a brief section
to remind the reader
of how they are defined.

Let PD stand for probability distribution.

We call $P_{\rvy|\rvx}:val(\rvy)
\times val(\rvx)
\rarrow  [0,1]$ a
{\bf Transition Probability Matrix} (TPM)\footnote{A TPM is also
known as a Conditional Probability Table (CPT).} if 

\beq
\sum_{y\in val(\rvy)}P_{\rvy|\rvx}(y|x) = 1
\label{eq-cbnet-unitarity}
\eeq
In other words,
a TPM is a conditional PD. A TPM of the form

\beq
P(y|x)= 
\delta(y, f(x))
\eeq
for some function
$f:val(\rvx)
\rarrow val(\rvy)$
is said to be {\bf deterministic}.



A bnet is a 
{\bf Directed Acyclic Graph} (DAG) 
with the nodes labelled by
random variables\footnote{As in
the first volume of this series, 
we indicate random variables by underlined letters}. Each
bnet stands for a full 
PD  of the node random variables expressed
as a product of a TPM for each node.
For example, the bnet

\beq
\calc=
\bcen
\xymatrix{
&\rvb\ar[ld]
\\
\rvc
&&\rva\ar[ll]\ar[lu]
}
\ecen
\label{eq-c-bnet-def}
\eeq
stands for the full 
PD

\beq
P(a,b,c)=
P(c|b,a)P(b|a)P(a)
\eeq

Bnets 
do not have free
indices
because 
their nodes are labelled by random
variables. It is convenient
to draw the DAG for a 
bnet but with the
underlining
removed from the random variables,
and then to
assign a numerical value to this new DAG.
The resultant DAG now
has free indices. We call it an
{\bf instantiation of the 
bnet}.
For example, from the
bnet $\calc$ 
of Eq.(\ref{eq-c-bnet-def}),
we get the
instantiation\footnote{
Note that we don't
include the root node
probabilities as part of 
the graph value. Thus,
 
$P(a,b) =
\underbrace{\xymatrix{ b\rarrow a}}_{P(b|a)}
P(a)$}


\beq
P(a,b,c)
=
P(c|b,a)P(b|a)P(a)
=
\bcen
\xymatrix{
&b\ar[ld]
\\
c
&&a\ar[ll]\ar[lu]
}
\ecen
P(a)
\eeq

Let $a^{:2} = (a_1, a_2)$.
Based on
the bnet $\calc$ of
Eq.(\ref{eq-c-bnet-def}),
define a new bnet $\calc'$
as follows

\beq
\calc'=
\bcen
\xymatrix{
&\rvb\ar[ld]
\\
\rvc
&&\rva^{:2}\ar[ll]|{\rva_2}\ar[lu]|{\rva_1}
}
\ecen
\eeq
$\calc'$ represents the 
the full PD 

\beq
P(a^{:2}, b, c)=
P(c|b,a_2)P(a_2|a^{:2})P(b|a_1)P(a_1|a^{:2})P(a^{:2}
)
\eeq
The 2 new nodes
$\rva_1$ and $\rva_2$
of bnet $\calc'$
are called 
{\bf marginalizer nodes}.
We assign to them
the following TPMs (printed in blue):

\beq \color{blue}
P[a'_i|\rva^{:2}=(a_1,a_2)] = \delta(a'_i, a_i)
\eeq
for $i=1,2$.
We can also
define an instantiation of $\calc'$ as follows:

\beq
P'(a^{:2}, b, c)
=
\bcen
\xymatrix{
&b\ar[ld]
\\
c
&&a^{:2}
\ar[ll]|{a_2}\ar[lu]|{a_1}
}
\ecen
P(a^{:2})
\eeq




\section{Quantum Bayesian Networks and
their Instantiations}

As far as I know,
Quantum Bayesian Networks
(qbnets) were invented by me in Ref.\cite{tucci-qbnets}.

qbnets are closely
analogous to classical
bnets, but the TPM
are replaced by {\bf Transition Amplitude 
Matrices (TAM)}.

Let PA stand for probability amplitude. 

We call $A_{\rvy|\rvx}:val(\rvy)
\times val(\rvx)
\rarrow  \CC$ a
TAM if

\beq
\sum_{y\in val(\rvy)}|A(y|x)|^2 = 1
\label{eq-qbnet-unitarity}
\eeq
Note that if $A$ is the matrix with entries
$\av{y|A|x}=A(y|x)$, then

\beq
\av{y|A^\dagger A|x}=\sum_{y\in val(\rvy)}|A(y|x)|^2 = 1
\eeq
If $A$ is a unitary matrix, then $A^\dagger A= AA^\dagger =1$ so 
\qt{half} ($A^\dagger A=1$) of
the definition
of unitary matrix is satisfied
by a TAM.
If both parts were 
satisfied, $A$ would have to be a square matrix.

A qbnet is a 
DAG
with the nodes labelled by
random variables. Each
qbnet stands for a full 
PA  of the node random variables expressed
as a product of a TAM for each node.
For example, the qbnet


\beq
\calq=
\bcen
\xymatrix{
&\rvb\ar[ld]
\\
\rvc
&&\rva\ar[ll]\ar[lu]
}
\ecen
\label{eq-q-bnet-def}
\eeq
stands for the full PA

\beq
A(a,b,c)
=
A(c|b,a)A(b|a)A(a)
\eeq

Qbnets 
do not have free
indices
because 
their nodes are labelled by random
variables. It is convenient
to draw the DAG for a 
qbnet but with the
underlining
removed from the random variables,
and then to
assign a numerical value to this new DAG.
The resultant DAG now
has free indices. We call it an
{\bf instantiation of the 
qbnet}.
For example, from the
bnet $\calq$ 
of Eq.(\ref{eq-q-bnet-def}),
we get the
instantiation

\beq
A(a,b,c)
=
A(c|b,a)A(b|a)A(a)
=
\bcen
\xymatrix{
&b\ar[ld]
\\
c
&&a\ar[ll]\ar[lu]
}
\ecen
A(a)
\eeq

Let $a^{:2} = (a_1, a_2)$.
Based on
the qbnet $\calq$ of
Eq.(\ref{eq-q-bnet-def}),
define a new qbnet $\calq'$
as follows

\beq
\calq'=
\bcen
\xymatrix{
&\rvb\ar[ld]
\\
\rvc
&&\rva^{:2}\ar[ll]|{\rva_2}\ar[lu]|{\rva_1}
}
\ecen
\eeq
$\calq'$  represents the 
the full PA 

\beq
A(a^{:2}, b, c)=
A(c|b,a_2)A(a_2|a^{:2})A(b|a_1)A(a_1|a^{:2})A(a^{:2}
)
\eeq
The 2 new nodes
$\rva_1$ and $\rva_2$
of qbnet $\calq'$
are called 
{\bf marginalizer nodes}.
We assign to them
the following TAMs (printed in blue):

\beq \color{blue}
A[a'_i|\rva^{:2}=(a_1,a_2)] = \delta(a'_i, a_i)
\eeq
for $i=1,2$.
We can also
define an instantiation of $\calq'$ as follows:

\beq
A(a^{:2}, b, c)
=
\bcen
\xymatrix{
&b\ar[ld]
\\
c
&&a^{:2}
\ar[ll]|{a_2}\ar[lu]|{a_1}
}
\ecen
A(a^{:2})
\eeq




\section{Birdtracks}

Tensors written in 
{\bf algebraic notation}
such as $T\indices{_a^b^c}$
were already discussed in
Section \ref{sec-tensors}

Birdtracks are a 
DAG used to represent 
algebraic tensor equations. 
The nodes of the DAG
are labelled by tensors and the 
arrows are labeled by the indices of 
the tensors: upper indices of a tensor are 
pictured as incoming arrows of the node,
and lower indices as outgoing arrows. 

We've
already discussed
in Section \ref{sec-tensors}
what we will
call the {\bf Counter Clockwise (CC) convention}  of drawing 
birdtrack nodes.
Now that we have 
discussed classical
and quantum bnets,
we would like to introduce an equivalent, more bnet like, convention that
we will call the {\bf Fully Label (FL) convention}.
Cvitanovic's
birdtracks book Ref.\cite{birdtracks-book}
uses the CC convention. 
We will use both.
No confusion will arise,
as long as it is clear
from context 
which convention
is being used.

Next we review 
the CC convention
and then describe the
FL convention for the first time. 
\hrule
\begin{enumerate}

\item {\bf CC convention}

In the CC convention,
we must specify for each the node, which arrow is first,
and then the CC 
order in which
the arrows 
enter or leave the node
is drawn so that it
reproduces 
the horizontal order
of the indices in the
algebraic notation for the tensor.
We shall often indicate the first arrow
by coloring it green.

For example,
\beq
\delta(b,a)=\indi(a=b)=
\delta^b_a =
\xymatrix{a&\ar[l]|\bullet b}
\eeq


\beq
X\indices{_a_b^c}
=
\bcen
\xymatrix@R=1pc{
a
&X\indices{_\rva_\rvb^\rvc}
\ar[dl]
\ar@[green][l]
\\
b
\\
c\ar[ruu]
}\ecen
\eeq
In this picture, the
green arrow indicates
which tensor index is first
horizontally in the algebraic
representation of the tensor.

\item {\bf FL convention}

In the FL convention,
the arrows must be labelled
by random (underlined)
variables, and
the names of the nodes
must also indicate
by underlined variables
what is the the order of
the indices

For example,
\beq
\delta(b,a)=\indi(a=b)=
\delta^b_a =
\xymatrix{a&\ar[l]|\bullet b}
\eeq


\beq
\bra{a,b}
X\indices{_\rva_\rvb^\rvc}
\ket{c}
=
X\indices{_a_b^c}
=
\bcen
\xymatrix@R=1pc{
\rva=a
&X\indices{_\rva_\rvb^\rvc}
\ar[dl]\ar[l]
\\
\rvb=b
\\
\rvc=c\ar[ruu]
}\ecen
\eeq
Sometimes, 
we will denote
this node simply by $X$.
This is okay as long as
we state that $X=X\indices{_\rva_\rvb^\rvc^\rvd}$, and we 
don't start using $X$ 
to represent 
a different version of $X\indices{_\rva_\rvb^\rvc^\rvd}$
with some of the indices
raised or lowered or 
their horizontal order changed.

Often, we will
write simply $a$ instead
of $\rva=a$. This
is similar to
the shorthand
$P(\rva=a)=P(a)$.

Note that,
unlike in the CC 
convention, in the FL
convention, the CC 
order in which the
arrows enter or leave
the node, is meaningless.
All orders are  equivalent. This is
akin to the notation
for bnets and qbnets.


\end{enumerate}
\hrule

If we don't do either 1 or 2, we won't
be able to distinguish between
the graphical
representations of $T^{1,2,3}$
and $T^{2,1,3}$, for example.

Two other features
of the CC and FL
conventions that 
we would like to
discuss before 
ending this section are
how to indicate 

\begin{itemize}
\item
{\bf noncyclic index contractions}; i.e., index 
contractions 
(i.e.,
summations)
that do not
introduce cycles, and
\item
{\bf traces}; i.e., 
index contractions
that do introduce cycles.
\end{itemize}

Noncyclic index contractions
will be indicated 
by an arrow connecting
two nodes,
with the symbol
$\sum a$ 
midway
in the arrow if 
the index $a$
is being contracted.
For simplicity,
we often omit
writing the $\sum a$
altogether.

For example (in CC convention),

\beq
X\indices{_a_b^c}
=
\bcen
\xymatrix@R=1pc{
a
&X\indices{_\rva_\rvb^\rvc}
\ar[dl]
\ar@[green][l]
\\
b
\\
c\ar[ruu]
}\ecen,
\quad
(X^*)\indices{_c^b^a}
=
\bcen
\xymatrix@R=1pc{
(X^*)\indices{_\rvc^\rvb^\rva}
&a\ar[l]
\\
&b\ar[lu]
\\
&c\ar@[green][luu]
}\ecen
\eeq


\beqa
(X^*)\indices{_c^b^a}
X\indices{_a_b^c}
&=&
\bcen
\xymatrix@R=1pc{
(X^*)\indices{_\rvc^\rvb^\rva}
&\sum a\ar[l]\ar@{<-}[r]
&
X\indices{_\rva_\rvb^\rvc}
\\
&\sum b\ar[ul]\ar@{<-}[ur]
&
\\
&\sum c\ar@{<-}[luu]
\ar[ruu]
&
\\
&
&
}
\ecen
\\
&=&
\bcen
\xymatrix@R=1pc{
X^*
&\ar[l]\ar@{<-}[r]
&
X
\\
&\ar[ul]\ar@{<-}[ur]
&
\\
&\ar@{<-}[luu]
\ar[ruu]
&
\\
&
&
}
\ecen
\eeqa

Birdtracks are
DAGs until
we are asked to
take a trace of 
one of their
indices. Tracing
ruins their acyclicity.
The acyclicity of DAGs
is mandated by causality.
The acyclicity of tracing
hints to its acausal
(or feedback) nature.

In this book,
we will indicate tracing
with a red undirected arrow. 
For example, in the CC
convention,
 



\beq
\tr_\rvb X\indices{_a_\rvb^\rvb}
=
\sum_b X\indices{_a_b^b}
=
\bcen
\xymatrix@R=1pc{
a
&X\indices{_\rva_\rvb^\rvc}
\ar[dl]\ar[l]
\\
\ar@[red]@{-}[d]
&
\\
\ar[ruu]
}\ecen
\eeq

If

\beq
R\indices{
^x_{b_3}^{a_3}
_{a_2}^{b_2}
}
S\indices{
_{x'}
_{b_2}
^{a_2}
_{a_1}
^{b_1}
} =
\bcen
\xymatrix{
&x\ar[d]
&
&x'\ar@{<-}[d]
\\
b_3
&R\ar[l]\ar@{<-}[ld]
&\sum  b_2\ar[l]
&S\ar[l]\ar@{<-}[ld]
&b_1\ar[l]
\\
a_3
&
&\sum a_2\ar@{<-}[lu]
&
&a_1\ar@{<-}[lu]
}
\ecen
\eeq
then

\beq
\tr_\rvx
R\indices{
^\rvx_{b_3}^{a_3}
_{a_2}^{b_2}
}
S\indices{
_\rvx
_{b_2}
^{a_2}
_{a_1}
^{b_1}
} 
=
\bcen
\xymatrix{
&\ar[d]
&
&\ar@{<-}[d]\ar@[red]@{-}[ll]
&
\\
&R\ar[l]\ar@{<-}[ld]
&
&S\ar@{<-}[ld]
\ar[ll]
&\ar[l]
\\
&
&\ar@{<-}[lu]
&
&\ar@{<-}[lu]
}
\ecen
\eeq

When using the FL convention,
it becomes clear that
birdtracks can
be understood
as instantiations of
qbnets, provided that we
weaken slightly the definition
of qbnets, by
not requiring
that the 
unitarity condition
Eq.(\ref{eq-qbnet-unitarity})
be satisfied. Also,
the outgoing arrows
of the nodes
of a birdtrack
must be understood
as the result of marginalizer nodes.
For example,
if the arrows leaving
a node are labelled $a_1$ and $a_2$,
then
these two arrows
must be understood 
as the result
of marginalizing
an arrow $a^{:2}=(a_1, a_2)$.